kind: pipeline
type: docker
name: default

steps:
- name: clone
  image: alpine/git
  commands:
    - git clone https://github.com/vckkk/blog.git
  environment:
    GIT_USERNAME: ${{secrets.git_username}}
    GIT_PASSWORD: ${{secrets.git_pwd}}

- name: build
  image: node:14
  commands:
    - rm -rf node_modules 
    - npm install
    - npm i lru-cache toml @vue/component-compiler-utils @babel/core vue-router autoprefixer
    - npm run build
  when:
    event: 
      - push
      - pull_request
    

- name: deploy
  image: appleboy/drone-scp
  settings:
    host: 49.232.203.23
    username: 
      from_secret: ssh_username
    password: 
      from_secret: ssh_password
    port: 8086
    target: /var/www/blog
    source:
      - ./docs/.vuepress/dist/*
