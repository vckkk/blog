<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Generator函数 | Vckkk&#39;s b1og</title>
    <meta name="description" content="Do what you want, So TMD what">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/favicon.png">
  <script href="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <script>
    (function(){
      const footer = window.document.getElementsByTagName('footer')[0];
      const div = window.document.createElement('div');
      div.style.color="white";
      div.innerHTML = '<span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>';
      footer && footer.insertBefore(div,footer.lastElementChild)
    })()
    </script>
    
    <link rel="preload" href="/assets/css/0.styles.f7e86f6b.css" as="style"><link rel="preload" href="/assets/js/app.97abffc4.js" as="script"><link rel="preload" href="/assets/js/13.e7ba8a7f.js" as="script"><link rel="prefetch" href="/assets/js/10.86da458e.js"><link rel="prefetch" href="/assets/js/11.571fbb7f.js"><link rel="prefetch" href="/assets/js/12.60b1f64f.js"><link rel="prefetch" href="/assets/js/14.b68b905f.js"><link rel="prefetch" href="/assets/js/15.e9acaa57.js"><link rel="prefetch" href="/assets/js/16.d82a426a.js"><link rel="prefetch" href="/assets/js/17.86b6fbbd.js"><link rel="prefetch" href="/assets/js/18.76858684.js"><link rel="prefetch" href="/assets/js/19.58725a8b.js"><link rel="prefetch" href="/assets/js/2.61793787.js"><link rel="prefetch" href="/assets/js/20.82acdce8.js"><link rel="prefetch" href="/assets/js/21.e1587062.js"><link rel="prefetch" href="/assets/js/22.ac7d4f0b.js"><link rel="prefetch" href="/assets/js/23.973217f5.js"><link rel="prefetch" href="/assets/js/24.9c2467eb.js"><link rel="prefetch" href="/assets/js/25.fcb26297.js"><link rel="prefetch" href="/assets/js/26.71134100.js"><link rel="prefetch" href="/assets/js/27.f1cad90c.js"><link rel="prefetch" href="/assets/js/28.07994a4c.js"><link rel="prefetch" href="/assets/js/29.800ac799.js"><link rel="prefetch" href="/assets/js/3.565d2664.js"><link rel="prefetch" href="/assets/js/30.7191b4c5.js"><link rel="prefetch" href="/assets/js/31.ed14a41a.js"><link rel="prefetch" href="/assets/js/32.95f8d603.js"><link rel="prefetch" href="/assets/js/33.bffdbda4.js"><link rel="prefetch" href="/assets/js/34.ede81f47.js"><link rel="prefetch" href="/assets/js/35.d11b6c14.js"><link rel="prefetch" href="/assets/js/36.e689e7b7.js"><link rel="prefetch" href="/assets/js/37.a19ba6c9.js"><link rel="prefetch" href="/assets/js/4.8315efb5.js"><link rel="prefetch" href="/assets/js/5.07782182.js"><link rel="prefetch" href="/assets/js/6.1a37de35.js"><link rel="prefetch" href="/assets/js/7.c2d8eabe.js"><link rel="prefetch" href="/assets/js/8.70490f32.js"><link rel="prefetch" href="/assets/js/9.e9107efb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f7e86f6b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><section id="global-layout" data-v-6115008e><header class="header" data-v-38e5da92 data-v-6115008e><div class="header-navbar" data-v-38e5da92><div class="flex-xbc main header-nav" data-v-38e5da92><div class="nav-link" data-v-38e5da92><a href="/" class="inblock link-logo router-link-active" data-v-38e5da92></a> <nav class="link-list" data-v-38e5da92><a href="/" class="list-item router-link-active" data-v-38e5da92>主页</a><a href="/Pages/" class="list-item router-link-active" data-v-38e5da92>文章归档</a><a href="/Daily/" class="list-item" data-v-38e5da92>积累</a></nav></div> <div class="search-box" data-v-38e5da92><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div> </header> <!----> <section class="page" data-v-6115008e><section class="info no-bg" data-v-79ff4ee6><article class="main info-content" data-v-246f9819 data-v-79ff4ee6><div class="content-header" data-v-246f9819><h1 class="header-title" data-v-246f9819>Generator函数</h1></div> <div class="flex-wcc content-tag" data-v-246f9819><!----> <!----> <div class="inblock tag-list" data-v-246f9819><a href="/tag/JavaScript/" class="tag-text" data-v-246f9819>JavaScript
      </a></div></div> <div class="content content__default" data-v-246f9819><p>JavaScript异步编程 ---- Generator</p> <h2 id="generator语法"><a href="#generator语法" class="header-anchor">#</a> Generator语法</h2> <p><code>Generator</code>是ES6提供的一种异步编程解决方案，本质上也是一个函数。简单的从写法上来，<code>Generator</code>函数在内部定义了一些相互独立且互不影响的状态。</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">'hi'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'helo'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">'end'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> say <span class="token operator">=</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sayHi<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { value: 'hi', done: false}</span>
sayHi<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { value: 'helo', done: false}</span>
sayHi<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { value: 'end', done: true}</span>
sayHi<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { value: undefined, done: true}</span>
sayHi<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { value: undefined, done: true}</span>
</code></pre></div><p>在调用函数<code>sayHi</code>时，并没有像一般函数那样直接执行，而是在遇见<code>next()</code>方法后，输出第一个“状态”--<code>hi</code>，再次调用<code>next</code>会以此打印<code>Genertaor</code>内部定义的“状态”。直至全部遍历后返回<code>{value: undefined， done: true}</code>并且在此之后的<code>next</code>方法都是返回这个。若函数没有<code>return</code>的话，也是返回<code>undefined</code>。</p> <p><code>yield</code>意为发放或产出。在<code>Genertaor</code>内部，<code>yield</code>就是一个标识，一个暂停的标识。
注意！是遇到<code>yield</code>后，暂停后面的一系列操作，并将后面紧跟的表达式的值作为返回对象的值。
<code>next</code>是<code>Genertaor</code>给我们的方法，也是我们唯一能和其内部进行数据交换的入口。<code>yield</code>是没用返回值，或者说返回值全是<code>undefined</code>。我们的<code>next</code>方法就能携带一个参数，<code>Genertaor</code>会这个参数当做上一个<code>yield</code>的返回值。
举个来自阮老师《ES6入门》的例子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token punctuation">(</span>y <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> y <span class="token operator">+</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>按照上述<code>yield</code>和<code>next</code>的作用，我们来调用这个函数。</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Object{value:6, done:false}  第一次next只执行了yield后面的 x+1</span>
a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Object{value:NaN, done:false} yield没有返回值，y为undefined</span>
a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Object{value:NaN, done:true} 同上，z为undefined</span>

<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  Object{value:6, done:false} x+1</span>
a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  Object{vale:8, done: false} 这里我们通过next方法向内部注入参数12，Genertaor会将12当做上一个yield的返回值，即x+1的值，所以现在 y=2*12；y/3为8；</span>
a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  Object{value: 42, done: treu} 同上参数13当做上一个yield的返回值，即z=13，那么此时x=5,y=24,z=13,则返回value=42 </span>
</code></pre></div><p><code>Genertaor</code>还有<code>return</code>和<code>throw</code>方法，这两个方法都类似<code>next</code>方法，<code>return</code>方法的参数会被当做上一次<code>yield</code>的返回值（这个效果同<code>next(params)</code>），并且结束整个<code>Genertaor</code>，无论后面是否还有<code>yield</code>。而<code>throw</code>是<code>Genertaor</code>的容错方法。我们能在外部抛出一个<code>error</code>，并在内部捕获。前提是<code>Genertaor</code>内部必须有<code>try...catch</code>语句，且在<code>genertaor.throw(error)</code>前，执行过一次<code>next</code>，即<code>Iterator</code>的指针开始工作，而且<code>throw</code>方法在执行时会默认的执行一次<code>next</code>。</p> <h2 id="genertaor与异步"><a href="#genertaor与异步" class="header-anchor">#</a> Genertaor与异步</h2> <p>在一开始就说<code>Genertaor</code>是解决异步的一种方案，那么具体是怎么进行的呢？
首先我们再来认识一下什么是异步编程。
字面意思，‘异’：不同。完成一个操作需要不同的步骤或流程模块。也就是说不是连续的（同步）。我们需要在完成前序任务后，等待一段时间，再紧接进行后续任务，而且在等待的时间内还能进行其他任务的操作。比如有一个任务是读取文件进行处理，任务的第一段是向操作系统发出请求，要求读取文件。然后，程序执行其他任务，等到操作系统返回文件，再接着执行任务的第二段（处理文件）。这种不连续的执行，就叫做异步。</p> <p>那么这个异步的过程和<code>Genertaor</code>有什么连续呢？对比不同函数，<code>Genertaor</code>内部有了暂停的概念，即可在函数执行过程中，暂停该函数且能够在暂停的地方继续执行，还能记住之前的状态。这不就和异步的概念完美契合。</p> <p>下面就看看<code>Genertaor</code>怎么对一个异步函数进行封装。</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fetch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-fetch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span>  url <span class="token operator">=</span> <span class="token string">'https://api.github.com/users/github'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>bio<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> g <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

result<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="content-time" data-v-246f9819><time datetime="2019-02-22" class="time-text" data-v-246f9819>最早创建于: 2019-11-12</time> <time datetime="2019-02-22" class="time-text" data-v-246f9819>上次更新于: 2019-12-5</time></div></article> <section class="flex-xb main info-nav" data-v-74bd5073 data-v-79ff4ee6><a href="/Pages/jenkins.html" class="flex-xb nav-item" data-v-74bd5073><div class="flex-xcc item-img" data-v-74bd5073><img data-src="/jenkins.jpg" alt="jenkins" loading="lazy" class="img lazy" data-v-74bd5073></div> <article class="flex-ysc item-content" data-v-74bd5073><h2 class="content-title" data-v-74bd5073>jenkins</h2> <div class="content" data-v-74bd5073></div></article></a> <a href="/Pages/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html" class="flex-xb nav-item" data-v-74bd5073><!----> <article class="flex-ysc item-content" data-v-74bd5073><h2 class="content-title" data-v-74bd5073>JavaScript高级程序设计</h2> <div class="content" data-v-74bd5073></div></article></a></section> <!----></section></section> <footer class="footer" data-v-991944de data-v-6115008e><nav class="link-list" data-v-991944de><a href="http://beian.miit.gov.cn" target="_blank" rel="noopener noreferrer" class="list-item" data-v-991944de>浙ICP备19049217号</a><a href="https://vuepress.vuejs.org/" target="_blank" rel="noopener noreferrer" class="list-item" data-v-991944de>Power by VuePress</a><a href="https://tolking.github.io/vuepress-theme-ououe/zh/" target="_blank" rel="noopener noreferrer" class="list-item" data-v-991944de>Theme by ououe</a></nav> <a href="/" class="copyright router-link-active" data-v-991944de>Vckkk's b1og © 2020</a></footer></section><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.97abffc4.js" defer></script><script src="/assets/js/13.e7ba8a7f.js" defer></script>
  </body>
</html>
