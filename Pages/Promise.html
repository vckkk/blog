<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹ | Vckkkâ€˜blog</title>
    <meta name="description" content="Do what you want">
    <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.9d30d405.css" as="style"><link rel="preload" href="/assets/js/app.28bfd549.js" as="script"><link rel="preload" href="/assets/js/11.6e752775.js" as="script"><link rel="prefetch" href="/assets/js/10.ddd61832.js"><link rel="prefetch" href="/assets/js/12.d398f8b1.js"><link rel="prefetch" href="/assets/js/13.d8534208.js"><link rel="prefetch" href="/assets/js/14.8c37f844.js"><link rel="prefetch" href="/assets/js/15.8292a4d1.js"><link rel="prefetch" href="/assets/js/16.468625d1.js"><link rel="prefetch" href="/assets/js/17.6d00b3e9.js"><link rel="prefetch" href="/assets/js/18.ff4bbaec.js"><link rel="prefetch" href="/assets/js/19.80a391b0.js"><link rel="prefetch" href="/assets/js/2.52a3a1cd.js"><link rel="prefetch" href="/assets/js/20.83c19b31.js"><link rel="prefetch" href="/assets/js/21.925ee5f5.js"><link rel="prefetch" href="/assets/js/22.b15b981d.js"><link rel="prefetch" href="/assets/js/23.ad8deb3a.js"><link rel="prefetch" href="/assets/js/24.4769dcc1.js"><link rel="prefetch" href="/assets/js/25.e1e67629.js"><link rel="prefetch" href="/assets/js/26.ce5e72e3.js"><link rel="prefetch" href="/assets/js/27.641a9754.js"><link rel="prefetch" href="/assets/js/28.7918e1f8.js"><link rel="prefetch" href="/assets/js/3.e85581c0.js"><link rel="prefetch" href="/assets/js/4.badc915c.js"><link rel="prefetch" href="/assets/js/5.c8ade4a4.js"><link rel="prefetch" href="/assets/js/6.b0d231c5.js"><link rel="prefetch" href="/assets/js/7.344b2ca7.js"><link rel="prefetch" href="/assets/js/8.b0843215.js"><link rel="prefetch" href="/assets/js/9.17499c5b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9d30d405.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><section id="global-layout" data-v-6115008e><header class="header" data-v-38e5da92 data-v-6115008e><div class="header-navbar" data-v-38e5da92><div class="flex-xbc main header-nav" data-v-38e5da92><div class="nav-link" data-v-38e5da92><a href="/" class="inblock link-logo router-link-active" data-v-38e5da92></a> <nav class="link-list" data-v-38e5da92><a href="/" class="list-item router-link-active" data-v-38e5da92>ä¸»é¡µ</a><a href="/Pages/" class="list-item router-link-active" data-v-38e5da92>æ–‡ç« å½’æ¡£</a><a href="/Daily/" class="list-item" data-v-38e5da92>ç§¯ç´¯</a></nav></div> <div class="search-box" data-v-38e5da92><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div> </header> <!----> <section class="page" data-v-6115008e><section class="info no-bg" data-v-79ff4ee6><article class="main info-content" data-v-246f9819 data-v-79ff4ee6><div class="content-header" data-v-246f9819><h1 class="header-title" data-v-246f9819>JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹</h1></div> <div class="flex-wcc content-tag" data-v-246f9819><!----> <!----> <div class="inblock tag-list" data-v-246f9819><a href="/tag/JavaScript/" class="tag-text" data-v-246f9819>JavaScript
      </a></div></div> <div class="content content__default" data-v-246f9819><p>JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹ ---- Promise</p> <p>äº†è§£JavaScriptçš„å¼‚æ­¥ç¼–ç¨‹ä¹‹å‰éœ€è¦å…ˆå­¦ä¹ <a href="https://blog.webhbz.com/Pages/eventloop.html" target="_blank" rel="noopener noreferrer">JavaScriptçš„æœ‰å…³è¿è¡Œæœºåˆ¶<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
ä¸ºäº†åœ¨æ•´ä½“ä¸Šæœ‰ä¸ªå……åˆ†çš„è®¤è¯†ï¼Œå¯ä»¥å…ˆé˜…è¯»ä¸€ä¸‹çŸ¥ä¹ä¸Šçš„è¿™ç¯‡<a href="https://zhuanlan.zhihu.com/p/66593213" target="_blank" rel="noopener noreferrer">æ–‡ç« <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œç›¸å¯¹ç®€å•ä¾¿äºç†è§£ã€‚</p> <h2 id="ä»€ä¹ˆæ˜¯promise"><a href="#ä»€ä¹ˆæ˜¯promise" aria-hidden="true" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯Promise</h2> <p>Promiseæœ€æ—©ç”±ç¤¾åŒºæå‡ºï¼Œæ˜¯ç”¨æ¥è§£å†³å›è°ƒåœ°ç‹±çš„æ–¹æ¡ˆï¼ŒES6 å°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ï¼ŒåŸç”Ÿæä¾›äº†<code>Promise</code>å¯¹è±¡ã€‚</p> <blockquote><p>æ‰€è°“çš„<code>Promise</code>ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚   ---- ã€ŠECMAScript 6 å…¥é—¨ã€‹</p></blockquote> <p>Promiseå¯¹è±¡åœ¨åˆ›å»ºåï¼Œå°±ä¼šåˆ›å»ºå†…éƒ¨çŠ¶æ€æœºï¼ŒPromiseå¯¹è±¡ä»£è¡¨äº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œè€ŒçŠ¶æ€æœºå°±åŒ…å«äº†è¿™ä¸ªå¼‚æ­¥æ“ä½œçš„çŠ¶æ€ï¼Œ<code>pendding</code>ï¼Œ<code>fulfilled</code>ï¼Œ<code>rejected</code>ï¼Œ
åœ¨<code>Promise</code>å¯¹è±¡ä¸­ï¼Œåªä¼šå­˜åœ¨ä¸Šè¿°ä¸‰ç§çŠ¶æ€ä¸­çš„ä¸€ç§ï¼Œä¸”ä¸ºä¸å¯é€†çš„ï¼Œä¸å—å¤–ç•Œå½±å“ã€‚</p> <h2 id="åˆ›å»ºä»¥åŠä½¿ç”¨promise"><a href="#åˆ›å»ºä»¥åŠä½¿ç”¨promise" aria-hidden="true" class="header-anchor">#</a> åˆ›å»ºä»¥åŠä½¿ç”¨Promise</h2> <p>åœ¨ES6ä¸­æœ‰åŸç”Ÿçš„Promiseæ„é€ å‡½æ•°ï¼Œä½¿ç”¨å…³é”®å­—<code>new</code> æ¥åˆ›å»ºä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä¸ºå‚æ•°ï¼Œå°†è¿™ä¸ªå‚æ•°æš‚åä¸º'fn' ï¼Œ'fn'åˆæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸”å‡ä¸ºå‡½æ•°</span>
  <span class="token keyword">const</span> flag <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">.5</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ä½¿ç”¨resolveå°†promiseçŠ¶æ€ä»pendingå˜ä¸ºresolved'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'å¤§äº0.5'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ä½¿ç”¨rejectå°†promiseçŠ¶æ€ä»pendingå˜ä¸ºrejected'</span><span class="token punctuation">)</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'å°äº0.5'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span>  <span class="token comment">// -- 'å¤§äº0.5'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reject<span class="token punctuation">)</span>  <span class="token comment">// -- 'å°äº0.5'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>æˆ‘ä»¬æ¥ä¸€ç‚¹ç‚¹æ‹†åˆ†è¿™ä¸ª<code>Promise</code>ï¼Œå¥¹æ¥æ”¶äº†ä¸€ä¸ªå‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°åˆæœ‰ä¸¤ä¸ªå‚æ•°<code>resolve</code>ï¼Œ<code>reject</code>ï¼Œè¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Promiseä¸ºæˆ‘ä»¬åˆ›å»ºå¥½çš„<code>å‡½æ•°</code>ã€‚è¿™ä¸¤ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†<code>Promise</code>çš„çŠ¶æ€ä»<code>pending</code>ï¼ˆç­‰å¾…ï¼‰è½¬æ¢ä¸º<code>resolved</code>ï¼ˆå·²è§£å†³ï¼‰æˆ–è€…ä»<code>pending</code>ï¼ˆç­‰å¾…ï¼‰è½¬æ¢ä¸º<code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚
è€Œåœ¨Promiseåˆ›å»ºåï¼Œæœ‰ä¸€äº›è‡ªèº«çš„æ–¹æ³•ã€‚è¿™é‡Œå…ˆåªè¯´<code>then</code>ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸¤ä¸ª<code>å‡½æ•°</code>ä½œä¸ºå‚æ•°ï¼Œè¿™é‡Œå°±å’Œä¸Šé¢ä¼ å…¥Promiseçš„æ„é€ å‡½æ•°ä¸­çš„å‚æ•°å‡½æ•°ï¼ˆ<code>fn</code>ï¼‰çš„ä¸¤ä¸ªå‚æ•°ï¼ˆ<code>resolve</code>,<code>reject</code>ï¼‰å¯¹åº”ä¸Šäº†ã€‚å¾ˆæ˜¾ç„¶ï¼Œ<code>then</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°ï¼Œæ¥æ”¶åˆ°<code>resolve</code>ä¼ é€’å‡ºçš„æ•°æ®ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°å°±æ¥æ”¶åˆ°äº†<code>reject</code>ä¼ é€’å‡ºçš„æ•°æ®ã€‚
é‚£ä¹ˆ<code>Promise</code>æ˜¯æ€ä¹ˆè§£å†³å¼‚æ­¥æ“ä½œçš„å›è°ƒåœ°ç‹±å‘¢ï¼Ÿç®€å•çš„è¯´å°±æ˜¯ç”¨<code>Promsie</code>å¯¹è±¡åŒ…è£¹ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå¼‚æ­¥æ“ä½œåªåœ¨<code>Promise</code>å¯¹è±¡å†…éƒ¨ï¼Œä¸å—å¤–éƒ¨å½±å“åŒæ—¶ä¹Ÿä¸é˜»å¡å¤–éƒ¨ï¼Œåœ¨è¿™ä¸ªå¼‚æ­¥æ“ä½œæœ‰äº†ç»“æœåï¼Œé€šè¿‡<code>then</code>æ–¹æ³•å’Œå¤–éƒ¨è¿›è¡Œæ•°æ®ä¼ é€’ã€‚å¦‚ä¸‹ï¼š</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span> <span class="token operator">?</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'fail'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>è¿™é‡Œçš„<code>setTimeout</code>å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œåœ¨1ç§’åå¾—åˆ°ç»“æœã€‚è‹¥å¤§äº0.5çš„è¯ï¼Œ<code>resolve</code>å°±ä¼šæ‰§è¡Œï¼Œåˆ™<code>Promise</code>çš„çŠ¶æ€ä»<code>pending</code>å˜ä¸º<code>fulfilled</code>ï¼Œå¦åˆ™å˜ä¸º<code>rejected</code>ï¼Œå¼‚æ­¥æ“ä½œä¸­çš„æ•°æ®(â€˜successâ€™æˆ–â€˜failâ€™)ä¼šé€šè¿‡å‡½æ•°ä¼ é€’åˆ°<code>Promise</code>å¤–éƒ¨ï¼Œæˆ‘ä»¬é€šè¿‡<code>then</code>è·å–åˆ°è¯¥æ•°æ®.
é‚£ä¹ˆç®€å•çš„<code>Promise</code>å¯¹è±¡æˆ‘ä»¬å·²ç»äº†è§£äº†,ä½†æ˜¯ä»–æ˜¯æ€ä¹ˆæ¥è§£å†³å›ç­”åœ°ç‹±çš„å‘¢?å…¶å®å¾ˆç®€å•,å› ä¸º<code>then</code>æ–¹æ³•ä¼š<code>return</code>ä¸€ä¸ª<code>Promise</code>å¯¹è±¡æ¥ä¾›æˆ‘ä»¬ä½¿ç”¨.åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºæ–°çš„<code>Promise</code>å¯¹è±¡.
ä¸¾ä¸ªğŸŒ°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pm1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'å‡è£…è¿™æ˜¯å¼‚æ­¥æ“ä½œçš„æˆåŠŸçš„ç»“æœ'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// @1 ä½¿ç”¨return é»˜è®¤çš„Promiseå¯¹è±¡</span>
pm1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ¥æ”¶Promiseä¼ å‡ºçš„:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">'æˆ‘æ˜¯è¢«then returnå‡ºæ¥çš„'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥æ”¶ä¸Šä¸€ä¸ªthen:&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token string">&quot;æˆ‘è¿˜æ˜¯è¢«then returnå‡ºæ¥çš„&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ¥æ”¶ä¸Šä¸€ä¸ªthen:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">--</span><span class="token operator">-</span>æ§åˆ¶å°æ‰“å°å¦‚ä¸‹
æ¥æ”¶Promiseä¼ å‡ºçš„<span class="token punctuation">:</span> å‡è£…è¿™æ˜¯å¼‚æ­¥æ“ä½œçš„æˆåŠŸçš„ç»“æœ
æ¥æ”¶ä¸Šä¸€ä¸ªthen<span class="token punctuation">:</span> æˆ‘æ˜¯è¢«then <span class="token keyword">return</span>å‡ºæ¥çš„
æ¥æ”¶ä¸Šä¸€ä¸ªthen<span class="token punctuation">:</span> æˆ‘è¿˜æ˜¯è¢«then <span class="token keyword">return</span>å‡ºæ¥çš„
Promise <span class="token punctuation">{</span><span class="token operator">&lt;</span>resolved<span class="token operator">&gt;</span><span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>

<span class="token comment">// @2 æ‰‹åŠ¨åˆ›å»ºPromise</span>
pm1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;pm1å¼‚æ­¥:&quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pm2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'pm2å¼‚æ­¥æ“ä½œæˆåŠŸçš„ç»“æœ'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> pm2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result2</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;pm2å¼‚æ­¥:&quot;</span><span class="token punctuation">,</span>result2<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">--</span><span class="token operator">-</span> æ§åˆ¶å°æ‰“å°å¦‚ä¸‹
pm1å¼‚æ­¥<span class="token punctuation">:</span> å‡è£…è¿™æ˜¯å¼‚æ­¥æ“ä½œçš„æˆåŠŸçš„ç»“æœ
Promise <span class="token punctuation">{</span><span class="token operator">&lt;</span>pending<span class="token operator">&gt;</span><span class="token punctuation">}</span>
<span class="token comment">// 2så</span>
pm2å¼‚æ­¥<span class="token punctuation">:</span> pm2å¼‚æ­¥æ“ä½œæˆåŠŸçš„ç»“æœ
<span class="token operator">--</span><span class="token operator">-</span>
</code></pre></div><p>è¿™å°±æ˜¯å¸¸è§çš„<code>Promis</code>çš„é“¾å¼è°ƒç”¨,å…¶å®<code>Promise</code>å°±æ˜¯åŸç”Ÿå°è£…çš„ä¸€ä¸ªå¯¹è±¡,çº¦å®šåˆ›å»ºæ˜¯ä¼ å…¥ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«åœ¨æˆåŠŸå’Œå¤±è´¥åè°ƒç”¨,åˆåœ¨<code>then</code>çš„ä¸¤å‚æ•°(å‡ä¸ºå‡½æ•°)ä¸­è·å–.ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹<code>catch</code>å’Œå…¶ä»–åŸç”Ÿæ–¹æ³•çš„ä½¿ç”¨åœºæ™¯.</p> <h3 id="catch"><a href="#catch" aria-hidden="true" class="header-anchor">#</a> catch</h3> <p>ä¸€å¥è¯æ¥è§£é‡Š,<code>catch</code> === <code>then(null,reject)</code>.
<code>catch</code>æ˜¯ç”¨æ¥æ•æ‰<code>Promis</code>ä¸­çš„å¼‚å¸¸,ä¹Ÿå°±æ˜¯å¤±è´¥åä¼ é€’å‡ºçš„ä¿¡æ¯.<code>then</code>æ˜¯å¯ä»¥åŒæ—¶æ¥å—å¤±è´¥å’ŒæˆåŠŸå<code>Promise</code>ä»å†…éƒ¨ä¼ å‡ºçš„æ•°æ®,ä½†æ˜¯æœªæ¥æ–¹ä¾¿é˜…è¯»å’Œç»´æŠ¤,ä¸€èˆ¬åœ¨<code>then</code>ä¸­åªæ‰§è¡ŒæˆåŠŸçš„.æˆ‘ä»¬å°†æ•´ä¸ªè¿‡ç¨‹ä¸­çš„å¼‚å¸¸æ”¾åˆ°æœ€å,é€šè¿‡<code>catch</code>æ¥æ•è·.å†ä¸¾ä¸ªğŸŒ°:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pmCatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'fail'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

pmCatch<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this is then'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pmCatch2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> pmCatch2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  cpnsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'then:'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catch:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">--</span><span class="token operator">-</span>æ§åˆ¶å°æ‰“å°å¦‚ä¸‹
catch<span class="token punctuation">:</span> fail
Promise <span class="token punctuation">{</span><span class="token operator">&lt;</span>resolved<span class="token operator">&gt;</span><span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>

</code></pre></div><p>çœ‹ä¸‹æ‰“å°ç»“æœ,å¥½åƒè·Ÿæƒ³è±¡ä¸­çš„ä¸å¤ªä¸€æ ·.è¿™é‡Œæ²¡æœ‰æ‰“å°å‡ºâ€˜this is thenâ€™å’Œâ€˜then:successâ€™,è€Œæ˜¯ç›´æ¥æ‰“å°äº†â€˜catch: failâ€™.æ˜æ˜¾çš„åœ¨æ•´ä¸ª<code>Promise</code>é“¾ä¸­,åªè¦å‡ºç°äº†<code>reject</code>äº†,æ•´ä¸ª<code>Promise</code>çš„çŠ¶æ€å°±ä¼šå‡å›ºä¸”ä¸ä¼šå˜åŒ–.å¦å¤–,<code>then</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœè¿è¡Œä¸­æŠ›å‡ºé”™è¯¯ï¼Œä¹Ÿä¼šè¢«<code>catch</code>æ–¹æ³•æ•è·ã€‚è€Œä¸”<code>Promise</code>å¯¹è±¡å¯¹äºå¼‚å¸¸æœ‰ç±»ä¼¼å†’æ³¡çš„æ€§è´¨,å¼‚å¸¸ä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ª<code>catch</code>è¯­å¥æ•è·ã€‚</p> <h3 id="promise-finally"><a href="#promise-finally" aria-hidden="true" class="header-anchor">#</a> Promise.finally()</h3> <p><code>finally</code>æ–¹æ³•ç”¨äºæŒ‡å®šä¸ç®¡<code>Promise</code>å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚è¯¥æ–¹æ³•æ˜¯ ES2018 å¼•å…¥æ ‡å‡†çš„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>
promise
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>Â·Â·Â·<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>Â·Â·Â·<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>Â·Â·Â·<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="promise-all"><a href="#promise-all" aria-hidden="true" class="header-anchor">#</a> Promise.all()</h3> <p><code>Promise.all()</code>æ–¹æ³•ç”¨äºå°†å¤šä¸ª<code>Promise</code>å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„<code>Promise</code>å®ä¾‹.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p1 p2 p3 å‡ä¸ºPromiseå¯¹è±¡</span>
</code></pre></div><p><code>Promise.all()</code>æ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰<code>Iterator</code>æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯<code>Promise</code>å®ä¾‹ã€‚
<code>p</code>çš„çŠ¶æ€ç”±<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>å†³å®šï¼Œåˆ†æˆä¸¤ç§æƒ…å†µã€‚</p> <ul><li>åªæœ‰<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„çŠ¶æ€éƒ½å˜æˆ<code>fulfilled</code>ï¼Œ<code>p</code>çš„çŠ¶æ€æ‰ä¼šå˜æˆ<code>fulfilled</code>ï¼Œæ­¤æ—¶<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</li> <li>åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«<code>rejected</code>ï¼Œ<code>p</code>çš„çŠ¶æ€å°±å˜æˆ<code>rejected</code>ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«<code>reject</code>çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</li></ul> <p>ä¸€èˆ¬çš„ä½¿ç”¨åœºæ™¯æ˜¯æ•°æ®åŒæ—¶ä¾èµ–äºå¤šä¸ªè¯·æ±‚çš„è¿”å›å€¼æ—¶.</p> <h3 id="promis-race"><a href="#promis-race" aria-hidden="true" class="header-anchor">#</a> Promis.race()</h3> <p><code>Promise.race()</code>æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª<code>Promise</code>å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„<code>Promise</code>å®ä¾‹ã€‚å…¶å‚æ•°æ ¼å¼åŒ<code>Promise.all()</code>;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p1 p2 p3 å‡ä¸ºPromiseå¯¹è±¡</span>
</code></pre></div><p>åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œ<code>p</code>çš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„<code>Promise</code>å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚â€œè¡Œâ€å¦‚å…¶å,ç«è·‘.è°æœ€æ—©è·‘å®Œå¬è°çš„.</p> <h3 id="promise-any"><a href="#promise-any" aria-hidden="true" class="header-anchor">#</a> Promise.any()</h3> <p><code>Promise.any()</code>æ–¹æ³•æ¥å—ä¸€ç»„<code>Promise</code>å®ä¾‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„<code>Promise</code>å®ä¾‹ã€‚åªè¦å‚æ•°å®ä¾‹æœ‰ä¸€ä¸ªå˜æˆ<code>fulfilled</code>çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ<code>fulfilled</code>çŠ¶æ€ï¼›å¦‚æœæ‰€æœ‰å‚æ•°å®ä¾‹éƒ½å˜æˆ<code>rejected</code>çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ<code>rejected</code>çŠ¶æ€ã€‚</p> <h3 id="å…¶ä»–"><a href="#å…¶ä»–" aria-hidden="true" class="header-anchor">#</a> å…¶ä»–</h3> <p>å…¶ä»–çš„è¿˜æœ‰<code>Promise.resolve()</code>,<code>Promise.reject()</code>,ä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•è¯¦æƒ…å‚è€ƒé˜®å¤§çš„<a href="http://es6.ruanyifeng.com/#docs/promise#Promise-resolve" target="_blank" rel="noopener noreferrer">ã€ŠES6å…¥é—¨ã€‹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="content-time" data-v-246f9819><time datetime="2019-02-22" class="time-text" data-v-246f9819>åˆ›å»ºæ—¶é—´: 2019-11-7</time> <time datetime="2019-02-22" class="time-text" data-v-246f9819>æ›´æ–°æ—¶é—´: 2019-11-10</time></div></article> <section class="flex-xb main info-nav" data-v-74bd5073 data-v-79ff4ee6><a href="/Pages/2019-11-11-JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html" class="flex-xb nav-item" data-v-74bd5073><!----> <article class="flex-ysc item-content" data-v-74bd5073><h2 class="content-title" data-v-74bd5073>JavaScripté«˜çº§ç¨‹åºè®¾è®¡</h2> <div class="content" data-v-74bd5073></div></article></a> <a href="/Pages/net.html" class="flex-xb nav-item" data-v-74bd5073><!----> <article class="flex-ysc item-content" data-v-74bd5073><h2 class="content-title" data-v-74bd5073>ç½‘ç»œåŸºç¡€</h2> <div class="content" data-v-74bd5073><p>ç®€å•äº†è§£ç½‘ç»œåè®®ç­‰åŸºç¡€ç½‘ç»œçŸ¥è¯†</p>
</div></article></a></section> <!----></section></section> <footer class="footer" data-v-991944de data-v-6115008e><nav class="link-list" data-v-991944de><a href="https://vuepress.vuejs.org/" target="_blank" rel="noopener noreferrer" class="list-item" data-v-991944de>Power by VuePress</a><a href="https://tolking.github.io/vuepress-theme-ououe/zh/" target="_blank" rel="noopener noreferrer" class="list-item" data-v-991944de>Theme by ououe</a></nav> <a href="/" class="copyright router-link-active" data-v-991944de>Vckkkâ€˜blog Â© 2019</a></footer></section><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.28bfd549.js" defer></script><script src="/assets/js/11.6e752775.js" defer></script>
  </body>
</html>
