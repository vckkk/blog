<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reactjs | Vckkk&#39;s b1og</title>
    <meta name="description" content="Do what you want">
    <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.77d9d35f.css" as="style"><link rel="preload" href="/assets/js/app.f07ffecb.js" as="script"><link rel="preload" href="/assets/js/15.ad6b8380.js" as="script"><link rel="prefetch" href="/assets/js/10.b8a34a02.js"><link rel="prefetch" href="/assets/js/11.a98c4ce2.js"><link rel="prefetch" href="/assets/js/12.afa1c51d.js"><link rel="prefetch" href="/assets/js/13.2601d791.js"><link rel="prefetch" href="/assets/js/14.eec7a2a9.js"><link rel="prefetch" href="/assets/js/16.2bc8cdbb.js"><link rel="prefetch" href="/assets/js/17.d644d6f9.js"><link rel="prefetch" href="/assets/js/18.6e26f51b.js"><link rel="prefetch" href="/assets/js/19.54961c8f.js"><link rel="prefetch" href="/assets/js/2.3c3c7db3.js"><link rel="prefetch" href="/assets/js/20.3ae9836a.js"><link rel="prefetch" href="/assets/js/21.98f4c143.js"><link rel="prefetch" href="/assets/js/22.e6d65090.js"><link rel="prefetch" href="/assets/js/23.d8520cb3.js"><link rel="prefetch" href="/assets/js/24.34b860f0.js"><link rel="prefetch" href="/assets/js/25.41ba9705.js"><link rel="prefetch" href="/assets/js/26.0133d5a1.js"><link rel="prefetch" href="/assets/js/27.14b73d1e.js"><link rel="prefetch" href="/assets/js/28.4c39d7d0.js"><link rel="prefetch" href="/assets/js/29.be6f97bc.js"><link rel="prefetch" href="/assets/js/3.e85581c0.js"><link rel="prefetch" href="/assets/js/30.9f505041.js"><link rel="prefetch" href="/assets/js/31.e91e8294.js"><link rel="prefetch" href="/assets/js/32.29147875.js"><link rel="prefetch" href="/assets/js/33.c485d782.js"><link rel="prefetch" href="/assets/js/34.d9cebae3.js"><link rel="prefetch" href="/assets/js/35.ec36b2ce.js"><link rel="prefetch" href="/assets/js/4.6b591f82.js"><link rel="prefetch" href="/assets/js/5.47dbce7e.js"><link rel="prefetch" href="/assets/js/6.660764aa.js"><link rel="prefetch" href="/assets/js/7.9f8c819f.js"><link rel="prefetch" href="/assets/js/8.a4b41753.js"><link rel="prefetch" href="/assets/js/9.078300b1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.77d9d35f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><section id="global-layout" data-v-6115008e><header class="header" data-v-38e5da92 data-v-6115008e><div class="header-navbar" data-v-38e5da92><div class="flex-xbc main header-nav" data-v-38e5da92><div class="nav-link" data-v-38e5da92><a href="/" class="inblock link-logo router-link-active" data-v-38e5da92></a> <nav class="link-list" data-v-38e5da92><a href="/" class="list-item router-link-active" data-v-38e5da92>主页</a><a href="/Pages/" class="list-item router-link-active" data-v-38e5da92>文章归档</a><a href="/Daily/" class="list-item" data-v-38e5da92>积累</a></nav></div> <div class="search-box" data-v-38e5da92><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div> </header> <!----> <section class="page" data-v-6115008e><section class="info no-bg" data-v-79ff4ee6><article class="main info-content" data-v-246f9819 data-v-79ff4ee6><div class="content-header" data-v-246f9819><h1 class="header-title" data-v-246f9819>Reactjs</h1></div> <div class="flex-wcc content-tag" data-v-246f9819><!----> <!----> <div class="inblock tag-list" data-v-246f9819><a href="/tag/React/" class="tag-text" data-v-246f9819>React
      </a><a href="/tag/JavaScript/" class="tag-text" data-v-246f9819>JavaScript
      </a></div></div> <div class="content content__default" data-v-246f9819><h2 id="什么是react"><a href="#什么是react" aria-hidden="true" class="header-anchor">#</a> 什么是React</h2> <p><strong>A JavaScript library for building user interfacesß</strong></p> <p>一个用于构建用户页面的JavaScript库。如果你熟悉 MVC 概念的话，那么 React 的组件就相当于 MVC 里面的 View。如果你不熟悉也没关系，你可以简单地理解为，React.js 将帮助我们将界面分成了各个独立的小块，每一个块就是组件，这些组件之间可以组合、嵌套，就成了我们的页面。</p> <p>一个组件的显示形态和行为有可能是由某些数据决定的。而数据是可能发生改变的，这时候组件的显示形态就会发生相应的改变。而 React.js 也提供了一种非常高效的方式帮助我们做到了数据和组件显示形态之间的同步。</p> <p>React.js 不是一个框架，它只是一个库。它只提供 UI （view）层面的解决方案。在实际的项目当中，它并不能解决我们所有的问题，需要结合其它的库，例如 Redux、React-router 等来协助提供完整的解决方法。</p> <h2 id="什么是组件化"><a href="#什么是组件化" aria-hidden="true" class="header-anchor">#</a> 什么是组件化</h2> <p>现在前端大都推崇组件化思想，React.js也不例外，那到底什么是组件化？我们从一个简单的例子开始说起。
<br> <img alt="" data-src="https://cdn.nlark.com/yuque/0/2019/png/240921/1554191857857-6a224ff5-5599-4811-afb8-fc528cc9586b.png" loading="lazy" class="lazy"> <img alt="" data-src="https://cdn.nlark.com/yuque/0/2019/png/240921/1554191857872-487a88e1-f4d8-445a-a139-4e16b0e8d506.png" loading="lazy" class="lazy"></p> <p>这是一个点赞按钮，点击后会在&quot;点赞&quot;和&quot;取消&quot;之间切换。</p> <p>如果你对前端有些了解的话，这点东西不在话下，直接上手。</p> <div class="language-html extra-class"><pre class="language-html"><code>...//省略的公共部分
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>wrapper<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>like-btn<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>like-text<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>点赞<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>👍<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>​</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.like-btn'</span><span class="token punctuation">)</span> <span class="token comment">// 获取按钮DOM</span>
<span class="token keyword">const</span> buttonText <span class="token operator">=</span> button<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.like-text'</span><span class="token punctuation">)</span> <span class="token comment">// 获取按钮内部文字 </span>
<span class="token keyword">let</span> isLiked <span class="token operator">=</span> <span class="token boolean">false</span>
button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>         <span class="token comment">// 事件监听</span>
  isLiked <span class="token operator">=</span> <span class="token operator">!</span>isLiked
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isLiked<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    buttonText<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'取消'</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    buttonText<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'点赞'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre></div><p>​
现在一个简单的点赞按钮就写好了。可是你发现另外一个页面也需要这样的按钮，同事的项目中也需要这个功能，你现在只有一种方法：将html结构和JavaScript代码统统复制粘贴过去。这样的实现方式没有任何可复用性。</p> <p>结构复用与简单组件化
现在我们重写这个点赞按钮，让它具有一定的可复用性。首先我们写一个class类，里面有一个方法，我们就叫他render方法（用到ES6的字符串模块 <code></code>），这个方法返回了一段标识HTML结构的字符串。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">LikeButton</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`
      &lt;button id='like-btn'&gt;
          &lt;span class='like-text'&gt;赞&lt;/span&gt;
          &lt;span&gt;👍&lt;/span&gt;
        &lt;/button&gt;
      `</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>​然后我们就能用这个类来构造不同的实例按钮</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> wrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.wrapper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取div</span>
<span class="token keyword">const</span> likeButton1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LikeButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 构建实例</span>
wrapper<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> likeButton1<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  将返回的内容插入div中</span>
</code></pre></div><p>我们使用innerHTML简单粗暴的将按钮按进wrapper中。但是你会发现：按钮DOM是有了，那么点击事件怎么办？我们这个LikeButton类中所返回的button就是一段字符串，无法给其添加事件，DOM事件的API只能添加在DOM身上。所以现在的问题就是：怎么将这段表示DOM结构的字符串变成真正的DOM？</p> <p>假设现在有一个函数可以帮我们完成这个动作，createDOMFromString，我们向这个函数中传递一段HTML结构的字符串，他会将对于的DOM结构返回给我们。现在我们利用这个函数重新我们的LikeButton类</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">LikeButton</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> <span class="token function">creatrDOMFromString</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
      &lt;button id='like-btn'&gt;
        &lt;span class='like-text'&gt;赞&lt;/span&gt;
        &lt;span&gt;👍&lt;/span&gt;
      &lt;/button&gt;
  `</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>​
现在我们render返回的并不只是一段字符串了，而是一个已经添加过事件的DOM，现在我们就可以将DOM放置在页面上，因为现在已经不是字符串，所以不能用innerHTML，而是用appendChild</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> wrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.wrapper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> likeButton1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LikeButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
wrapper<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>likeButton1<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>​现在你再一次尝试点击按钮，就能在控制台看到打印出的 'click'，接下来，我们将完整的点赞功能写好</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">LikeButton</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>isLiked<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">changenLikeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> likeText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.like-text'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isLiked <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isLiked<span class="token punctuation">;</span>
    likeText<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isLiked <span class="token operator">?</span> <span class="token string">'取消'</span><span class="token punctuation">:</span><span class="token string">'点赞'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>；
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> <span class="token function">createDOMFromString</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
      &lt;button id='like-btn'&gt;
        &lt;span class='like-text'&gt;赞&lt;/span&gt;
        &lt;span&gt;👍&lt;/span&gt;
      &lt;/button&gt;     
      `</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeLikeText</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个构造函数添加了一个对象state用来保存当前按钮的状态，还给按钮新绑定了事件，点击会触发按钮的文本改变。现在只要在的地方实例化一下，就可以轻松使用。</p> <p>优化DOM操作
上面实现了点赞按钮的复用，也是一个简易的组件，不过我们发现在changeText方法中有手动操作DOM的动作，是因为数据改变我们要去更新页面内容，那么假设现在有不止一个数据可以更改页面内容，我们需要频繁的手动操作DOM吗？这里有一种解决方案：一旦有数据发生改变，我们就重新调用render，构建一个新的DOM。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">LikeButton</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>isLiked<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">changenLikeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      isLiked<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isLiked
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> <span class="token function">createDOMFromString</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
      &lt;button id='like-btn'&gt;
        &lt;span class='like-text'&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isLiked <span class="token operator">?</span> <span class="token string">'取消'</span><span class="token punctuation">:</span><span class="token string">'点赞'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;
        &lt;span&gt;👍&lt;/span&gt;
      &lt;/button&gt;     
      `</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeLikeText</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>​
对比一下更新后的代码，多了setState的方法，这个方法接受一个state参数（更新后的state），在方法内我们更新了this.state，然后又调用了render方法，根据新的state创建了新的DOM。这样就避免了手动DOM的动作。现在只是新构建了DOM，并没有表现在页面上，继续修改代码中的setState方法</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> oldEle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onStateChange<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span> <span class="token function">onStateChange</span><span class="token punctuation">(</span>oleEle<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token comment">// 然后在使用组件的时候</span>
<span class="token keyword">const</span> likeButton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LikeButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实例化组件</span>
wrapper<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>likeButton<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 第一次插入 DOM 元素</span>
likeButton<span class="token punctuation">.</span><span class="token function-variable function">onStateChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldEle<span class="token punctuation">,</span> newEle</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  wrapper<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newEle<span class="token punctuation">,</span> oldEle<span class="token punctuation">)</span> <span class="token comment">// 插入新的元素</span>
  wrapper<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>oldEle<span class="token punctuation">)</span> <span class="token comment">// 删除旧的元素</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在，每一次steState都会调用onStateChange方法，这个方法是在实例化后注入的，所以我们就可以随意编写这个方法。每当state发生变化，触发setState，然后调用onStateChange，我们就能在页面上插入新DOM并删除旧的DOM，虽然也很暴力并且严重影响性能，但是在React中，会被一种Virtual-DOM的策略有效解决。</p> <p>抽出组件的公共方法
上面已经完成了一个点赞按钮的组件，站在更长远的角度看，我们还可以将当前这个模式给抽象出来，以便写更多的组件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> oldEle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>onStateChange<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onStateChange</span><span class="token punctuation">(</span>oldEle<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">renderDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> <span class="token function">createDOMFromString</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onClick<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> createDOMFromString <span class="token operator">=</span> <span class="token punctuation">(</span>domString<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> domString<span class="token punctuation">;</span>
    <span class="token keyword">return</span> div<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">mount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">component<span class="token punctuation">,</span>wrapper</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper<span class="token punctuation">.</span><span class="token function">appenChild</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span><span class="token function">renderDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    component<span class="token punctuation">.</span>onStateChange <span class="token operator">=</span> <span class="token punctuation">(</span>oldEle<span class="token punctuation">,</span>newEle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      wrapper<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newEle<span class="token punctuation">,</span>oldEle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      wrapper<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>oldEle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>​
现在这个Component类比起之前的LikeButton类多了一点东西，我们逐一地看下，constructor的props参数是从外部传入的，我们可以用来个性化组件，renderDOM就是原来的render方法，这里的createDOMFromString只是为构建出的DOM添加一个div父节点，mount方法是将当前组件进行挂载，放置到我们预期的页面上。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">LikeButton</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constrcutor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      isliked<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  onClick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      color<span class="token punctuation">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
    &lt;button class=&quot;like-btn&quot; style=&quot;background-color:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;
      &lt;span class=&quot;like-text&quot;&gt;
        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isliked <span class="token operator">?</span> <span class="token string">'取消'</span> <span class="token punctuation">:</span> <span class="token string">'点赞'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
      &lt;/span&gt;
      &lt;span&gt;👍&lt;/span&gt;
    &lt;/button&gt;
  `</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
​
<span class="token keyword">const</span> wrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.wrapper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LikeButton</span><span class="token punctuation">(</span><span class="token punctuation">{</span>color<span class="token punctuation">:</span><span class="token string">'red'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>​
现在页面上就多了一个红色点赞按钮。到现在，已经基本学会了react组件的写法。这里的renderDOM就是react.js中的render函数，我们最早定义的createDOMFromString就是React.createElement方法，只不过在react中它解析的是JSX语法。而这个mount就是ReactDOM.render方法，将组件挂载到指定节点。</p></div> <div class="content-time" data-v-246f9819><time datetime="2019-02-22" class="time-text" data-v-246f9819>创建起始于: 2018-11-24</time> <time datetime="2019-02-22" class="time-text" data-v-246f9819>最后更新于: 2019-11-4</time></div></article> <section class="flex-xb main info-nav" data-v-74bd5073 data-v-79ff4ee6><a href="/Pages/eventloop.html" class="flex-xb nav-item" data-v-74bd5073><!----> <article class="flex-ysc item-content" data-v-74bd5073><h2 class="content-title" data-v-74bd5073>JavaScript的运行机制以及Event Loop</h2> <div class="content" data-v-74bd5073><p>了解JS运行机制，是了解学习JS的异步事件的基础，之后会着重学习JS的异步事件。</p>
</div></article></a> <a href="/Pages/communication.html" class="flex-xb nav-item" data-v-74bd5073><!----> <article class="flex-ysc item-content" data-v-74bd5073><h2 class="content-title" data-v-74bd5073>组建通信</h2> <div class="content" data-v-74bd5073><p>介绍Flutter中的组建通信方式，是构建Flutter应用的基础</p>
</div></article></a></section> <!----></section></section> <footer class="footer" data-v-991944de data-v-6115008e><nav class="link-list" data-v-991944de><a href="http://beian.miit.gov.cn" target="_blank" rel="noopener noreferrer" class="list-item" data-v-991944de>浙ICP备19049217号</a><a href="https://vuepress.vuejs.org/" target="_blank" rel="noopener noreferrer" class="list-item" data-v-991944de>Power by VuePress</a><a href="https://tolking.github.io/vuepress-theme-ououe/zh/" target="_blank" rel="noopener noreferrer" class="list-item" data-v-991944de>Theme by ououe</a></nav> <a href="/" class="copyright router-link-active" data-v-991944de>Vckkk's b1og © 2020</a></footer></section><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f07ffecb.js" defer></script><script src="/assets/js/15.ad6b8380.js" defer></script>
  </body>
</html>
