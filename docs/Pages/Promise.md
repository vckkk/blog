---
title: JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹
date: 2019-11-07
lang: zh-CN
display: home
tags:
  - JavaScript
categorise:
  - Blog
---

JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹ ---- Promise

<!-- more -->

  äº†è§£JavaScriptçš„å¼‚æ­¥ç¼–ç¨‹ä¹‹å‰éœ€è¦å…ˆå­¦ä¹ [JavaScriptçš„æœ‰å…³è¿è¡Œæœºåˆ¶](https://blog.webhbz.com/Pages/eventloop.html)
ä¸ºäº†åœ¨æ•´ä½“ä¸Šæœ‰ä¸ªå……åˆ†çš„è®¤è¯†ï¼Œå¯ä»¥å…ˆé˜…è¯»ä¸€ä¸‹çŸ¥ä¹Žä¸Šçš„è¿™ç¯‡[æ–‡ç« ](https://zhuanlan.zhihu.com/p/66593213)ï¼Œç›¸å¯¹ç®€å•ä¾¿äºŽç†è§£ã€‚

## ä»€ä¹ˆæ˜¯Promise

  Promiseæœ€æ—©ç”±ç¤¾åŒºæå‡ºï¼Œæ˜¯ç”¨æ¥è§£å†³å›žè°ƒåœ°ç‹±çš„æ–¹æ¡ˆï¼ŒES6 å°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ï¼ŒåŽŸç”Ÿæä¾›äº†`Promise`å¯¹è±¡ã€‚
> æ‰€è°“çš„`Promise`ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æžœã€‚ä»Žè¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»Žå®ƒå¯ä»¥èŽ·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚   ---- ã€ŠECMAScript 6 å…¥é—¨ã€‹

Promiseå¯¹è±¡åœ¨åˆ›å»ºåŽï¼Œå°±ä¼šåˆ›å»ºå†…éƒ¨çŠ¶æ€æœºï¼ŒPromiseå¯¹è±¡ä»£è¡¨äº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œè€ŒçŠ¶æ€æœºå°±åŒ…å«äº†è¿™ä¸ªå¼‚æ­¥æ“ä½œçš„çŠ¶æ€ï¼Œ`pendding`ï¼Œ`fulfilled`ï¼Œ`rejected`ï¼Œ
åœ¨`Promise`å¯¹è±¡ä¸­ï¼Œåªä¼šå­˜åœ¨ä¸Šè¿°ä¸‰ç§çŠ¶æ€ä¸­çš„ä¸€ç§ï¼Œä¸”ä¸ºä¸å¯é€†çš„ï¼Œä¸å—å¤–ç•Œå½±å“ã€‚

## åˆ›å»ºä»¥åŠä½¿ç”¨Promise
åœ¨ES6ä¸­æœ‰åŽŸç”Ÿçš„Promiseæž„é€ å‡½æ•°ï¼Œä½¿ç”¨å…³é”®å­—`new` æ¥åˆ›å»ºä¸€ä¸ª`Promise`å¯¹è±¡ã€‚

```JavaScript
const promise = new Promise ((resolve,reject) => { // æž„é€ å‡½æ•°æŽ¥å—ä¸€ä¸ªå‡½æ•°ä¸ºå‚æ•°ï¼Œå°†è¿™ä¸ªå‚æ•°æš‚åä¸º'fn' ï¼Œ'fn'åˆæŽ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸”å‡ä¸ºå‡½æ•°
  const flag = Math.random() > .5 ? true : false ;
  if(flag) {
    console.log('ä½¿ç”¨resolveå°†promiseçŠ¶æ€ä»Žpendingå˜ä¸ºresolved');
    resolve('å¤§äºŽ0.5')
  } else {
    console.log('ä½¿ç”¨rejectå°†promiseçŠ¶æ€ä»Žpendingå˜ä¸ºrejected')
    reject('å°äºŽ0.5')
  }
})


promise.then((resolve) => {
  console.log(resolve)  // -- 'å¤§äºŽ0.5'
},(reject) => {
  console.log(reject)  // -- 'å°äºŽ0.5'
})

```
æˆ‘ä»¬æ¥ä¸€ç‚¹ç‚¹æ‹†åˆ†è¿™ä¸ª`Promise`ï¼Œå¥¹æŽ¥æ”¶äº†ä¸€ä¸ªå‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°åˆæœ‰ä¸¤ä¸ªå‚æ•°`resolve`ï¼Œ`reject`ï¼Œè¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Promiseä¸ºæˆ‘ä»¬åˆ›å»ºå¥½çš„`å‡½æ•°`ã€‚è¿™ä¸¤ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†`Promise`çš„çŠ¶æ€ä»Ž`pending`ï¼ˆç­‰å¾…ï¼‰è½¬æ¢ä¸º`resolved`ï¼ˆå·²è§£å†³ï¼‰æˆ–è€…ä»Ž`pending`ï¼ˆç­‰å¾…ï¼‰è½¬æ¢ä¸º`rejected`ï¼ˆå·²å¤±è´¥ï¼‰ã€‚
è€Œåœ¨Promiseåˆ›å»ºåŽï¼Œæœ‰ä¸€äº›è‡ªèº«çš„æ–¹æ³•ã€‚è¿™é‡Œå…ˆåªè¯´`then`ï¼Œè¯¥æ–¹æ³•æŽ¥å—ä¸¤ä¸ª`å‡½æ•°`ä½œä¸ºå‚æ•°ï¼Œè¿™é‡Œå°±å’Œä¸Šé¢ä¼ å…¥Promiseçš„æž„é€ å‡½æ•°ä¸­çš„å‚æ•°å‡½æ•°ï¼ˆ`fn`ï¼‰çš„ä¸¤ä¸ªå‚æ•°ï¼ˆ`resolve`,`reject`ï¼‰å¯¹åº”ä¸Šäº†ã€‚å¾ˆæ˜¾ç„¶ï¼Œ`then`æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°ï¼ŒæŽ¥æ”¶åˆ°`resolve`ä¼ é€’å‡ºçš„æ•°æ®ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°å°±æŽ¥æ”¶åˆ°äº†`reject`ä¼ é€’å‡ºçš„æ•°æ®ã€‚
é‚£ä¹ˆ`Promise`æ˜¯æ€Žä¹ˆè§£å†³å¼‚æ­¥æ“ä½œçš„å›žè°ƒåœ°ç‹±å‘¢ï¼Ÿç®€å•çš„è¯´å°±æ˜¯ç”¨`Promsie`å¯¹è±¡åŒ…è£¹ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå¼‚æ­¥æ“ä½œåªåœ¨`Promise`å¯¹è±¡å†…éƒ¨ï¼Œä¸å—å¤–éƒ¨å½±å“åŒæ—¶ä¹Ÿä¸é˜»å¡žå¤–éƒ¨ï¼Œåœ¨è¿™ä¸ªå¼‚æ­¥æ“ä½œæœ‰äº†ç»“æžœåŽï¼Œé€šè¿‡`then`æ–¹æ³•å’Œå¤–éƒ¨è¿›è¡Œæ•°æ®ä¼ é€’ã€‚å¦‚ä¸‹ï¼š

```JavaScript
const promise = new Promise((resolve, reject) => {
    setTimeout(() => {
        Math.random() > 0.5 ? resolve('success') : reject('fail');
    }, 1000)
});


promise.then((result) => {
    console.log(result);
}, (err) => {
    console.log(err);
});

```
è¿™é‡Œçš„`setTimeout`å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œåœ¨1ç§’åŽå¾—åˆ°ç»“æžœã€‚è‹¥å¤§äºŽ0.5çš„è¯ï¼Œ`resolve`å°±ä¼šæ‰§è¡Œï¼Œåˆ™`Promise`çš„çŠ¶æ€ä»Ž`pending`å˜ä¸º`fulfilled`ï¼Œå¦åˆ™å˜ä¸º`rejected`ï¼Œå¼‚æ­¥æ“ä½œä¸­çš„æ•°æ®(â€˜successâ€™æˆ–â€˜failâ€™)ä¼šé€šè¿‡å‡½æ•°ä¼ é€’åˆ°`Promise`å¤–éƒ¨ï¼Œæˆ‘ä»¬é€šè¿‡`then`èŽ·å–åˆ°è¯¥æ•°æ®.
é‚£ä¹ˆç®€å•çš„`Promise`å¯¹è±¡æˆ‘ä»¬å·²ç»äº†è§£äº†,ä½†æ˜¯ä»–æ˜¯æ€Žä¹ˆæ¥è§£å†³å›žç­”åœ°ç‹±çš„å‘¢?å…¶å®žå¾ˆå®¹æ˜“æƒ³åˆ°çš„,æˆ‘ä»¬åœ¨`then`æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°(æŽ¥å—`resolve`çŠ¶æ€ä¼ é€’å‡ºæ•°æ®çš„å‡½æ•°)é‡Œå†æ¬¡åˆ›å»º`Promise`å¯¹è±¡å³å¯,è¿™æ ·æˆ‘ä»¬å°±èƒ½é€šè¿‡`then`æ¥é“¾å¼çš„è°ƒç”¨.ä¸¾ä¸ªðŸŒ°:

```js
const pm1 = new Promise((resolve,reject) => {
  
})
```